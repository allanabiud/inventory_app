{% extends 'layouts/home-base.html' %}
{% load static %}
{% block title %}View Item - Stockflow{% endblock %}
{% block content %}
  <div class="container-fluid mt-3 slide-in-left">
    <div class="card p-0 mx-auto shadow-sm overflow-hidden d-flex flex-column">
      <div class="p-5 pb-1 d-flex justify-content-between align-items-center border-0">
        <h4 class="mb-0">Item Details: {{ item.name }}</h4>
        <div class="d-flex align-items-center gap-2">
          <a href="{% url 'edit_item' item.pk %}"
             class="btn btn-sm btn-outline-success">
            <i class="bi bi-pencil-square me-1"></i> Edit Item
          </a>
          <button type="button"
                  class="btn btn-sm btn-outline-danger"
                  data-bs-toggle="modal"
                  data-bs-target="#deleteItemModal">
            <i class="bi bi-trash me-1"></i> Delete Item
          </button>
          <a href="{% url 'items' %}" class="btn btn-sm btn-outline-secondary">
            <i class="bi bi-x-lg"></i>
          </a>
        </div>
      </div>
      <div class="card-body px-5 pt-3">
        <div class="row g-4 mb-4 align-items-center">
          {# Image Section #}
          <div class="col-lg-3 col-md-4 d-flex flex-column align-items-center justify-content-center">
            <div class="border rounded p-3 bg-body-tertiary d-flex flex-column align-items-center justify-content-center"
                 style="width: 100%;
                        overflow: hidden">
              {# Removed height: 250px #}
              {% with first_image=item.images.first %}
                {% if first_image %}
                  <img src="{{ first_image.image.url }}"
                       alt="{{ item.name }} Image"
                       class="img-fluid h-100 w-100 object-fit-contain">
                {% else %}
                  <i class="bi bi-image-fill fs-1 text-body-tertiary opacity-75"></i>
                  <p class="text-body-tertiary mb-0 mt-2">No Image Available</p>
                {% endif %}
              {% endwith %}
            </div>
          </div>
          {# Basic Details Section #}
          <div class="col-lg-9 col-md-8 d-flex flex-column">
            <div class="col-12 mb-3">
              <p class="mb-0 text-body-secondary small">Item Name</p>
              <h5 class="fw-bold text-body">{{ item.name }}</h5>
            </div>
            <div class="row g-3 flex-grow-1">
              <div class="col-sm-6 col-lg-4">
                <p class="mb-0 text-body-secondary small">SKU</p>
                <p class="lead fw-bold">{{ item.sku }}</p>
              </div>
              <div class="col-sm-6 col-lg-4">
                <p class="mb-0 text-body-secondary small">Unit of Measure</p>
                <p class="lead">
                  {% if item.unit %}
                    {{ item.unit.name }}
                    {% if item.unit.abbreviation %}<span class="text-body-secondary">({{ item.unit.abbreviation }})</span>{% endif %}
                  {% else %}
                    <span class="text-body-secondary">N/A</span>
                  {% endif %}
                </p>
              </div>
              <div class="col-sm-6 col-lg-4">
                <p class="mb-0 text-body-secondary small">Category</p>
                <p class="lead">
                  {% if item.category %}
                    {{ item.category.name }}
                  {% else %}
                    <span class="text-body-secondary">N/A</span>
                  {% endif %}
                </p>
              </div>
              {# Add Description field here to utilize space if item has a description #}
              {% if item.description %}
                <div class="col-12">
                  <p class="mb-0 text-body-secondary small">Description</p>
                  <p class="lead">{{ item.description }}</p>
                </div>
              {% endif %}
            </div>
          </div>
        </div>
        <hr class="my-4">
        {# Pricing Section #}
        <h5 class="mb-3">Pricing Information</h5>
        <div class="row g-3 mb-4">
          <div class="col-md-6 col-lg-4">
            <div class="border rounded p-3 bg-body-tertiary h-100">
              <p class="mb-1 text-body-secondary small">Selling Price</p>
              <h5 class="fw-bold text-success">KES {{ item.selling_price|default:"0.00"|floatformat:2 }}</h5>
            </div>
          </div>
          <div class="col-md-6 col-lg-4">
            <div class="border rounded p-3 bg-body-tertiary h-100">
              <p class="mb-1 text-body-secondary small">Purchase Price</p>
              <h5 class="fw-bold text-info">KES {{ item.purchase_price|default:"0.00"|floatformat:2 }}</h5>
            </div>
          </div>
        </div>
        <hr class="my-4">
        {# Inventory Section #}
        <h5 class="mb-3">Inventory Status</h5>
        <div class="row g-3 mb-4">
          <div class="col-md-4">
            <div class="border rounded p-3 bg-body-tertiary h-100">
              <p class="mb-1 text-body-secondary small">Opening Stock</p>
              <h5 class="fw-bold text-body">{{ item.opening_stock|default:"0" }}</h5>
            </div>
          </div>
          <div class="col-md-4">
            <div class="border rounded p-3 bg-body-tertiary h-100">
              <p class="mb-1 text-body-secondary small">Current Stock</p>
              <h5 class="fw-bold text-primary">{{ item.current_stock|default:"0" }}</h5>
              {% if item.reorder_point and item.current_stock <= item.reorder_point %}
                <span class="badge bg-warning text-dark mt-2">Below Reorder Point!</span>
              {% endif %}
            </div>
          </div>
          <div class="col-md-4">
            <div class="border rounded p-3 bg-body-tertiary h-100">
              <p class="mb-1 text-body-secondary small">Reorder Point</p>
              <h5 class="fw-bold text-body">{{ item.reorder_point|default:"0" }}</h5>
            </div>
          </div>
        </div>
        <hr class="my-4">
        {# Transactions Section #}
        <h5 class="mb-3">Transactions (Coming Soon)</h5>
        <div class="row g-3 mb-4">
          <div class="col-12">
            <div class="border border-info p-4 rounded text-center bg-info-subtle">
              <i class="bi bi-clock-history fs-3 text-info"></i>
              <p class="mb-0 mt-2 text-info">
                Details of sales, purchases, and stock adjustments related to this item will appear here.
              </p>
            </div>
          </div>
        </div>
        <hr class="my-4">
        {# Statistics Section #}
        <h5 class="mb-3">Statistics (Coming Soon)</h5>
        <div class="row g-3 mb-4">
          <div class="col-12">
            <div class="border border-primary p-4 rounded text-center bg-primary-subtle">
              <i class="bi bi-bar-chart-line fs-3 text-primary"></i>
              <p class="mb-0 mt-2 text-primary">
                Key statistics like sales trends, profit margins, and stock turnover will be available here.
              </p>
            </div>
          </div>
        </div>
      </div>
      {# end card-body #}
    </div>
    {# end card #}
  </div>
  {# end container-fluid #}
  {# Delete Item Modal (remains unchanged as it uses standard Bootstrap components) #}
  <div class="modal fade"
       id="deleteItemModal"
       tabindex="-1"
       aria-labelledby="deleteItemModalLabel"
       aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="deleteItemModalLabel">Confirm Delete</h5>
          <button type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Are you sure you want to delete "<strong>{{ item.name }}</strong>"? This action cannot be undone.
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <form action="{% url 'delete_item' item.pk %}"
                method="post"
                class="d-inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger">Delete</button>
          </form>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
