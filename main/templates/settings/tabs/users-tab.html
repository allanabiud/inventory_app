<div class="tab-pane show active"
     id="users-tab-pane"
     role="tabpanel"
     aria-labelledby="users-tab"
     tabindex="0">
  <div class="d-flex justify-content-end align-items-center mb-3">
    <button class="btn btn-sm btn-success"
            data-bs-toggle="modal"
            data-bs-target="#inviteUserModal">
      <i class="bi bi-person-plus me-1"></i> Invite User
    </button>
  </div>
  {% if users %}
    <div class="table-responsive shadow-sm rounded">
      <table class="table table-striped table-hover align-middle mb-0">
        <thead class="bg-body-tertiary">
          <tr>
            <th scope="col">Name</th>
            <th scope="col">Email</th>
            <th scope="col">Role</th>
            <th scope="col">Date Joined</th>
            <th scope="col">Status</th>
            <th scope="col">Invited</th>
          </tr>
        </thead>
        <tbody>
          {# Registered Users #}
          {% for user in users %}
            <tr>
              <td>{{ user.get_full_name|default:user.username }}</td>
              <td class="text-muted">{{ user.email }}</td>
              <td>
                {% if user.is_superuser %}
                  <span class="badge bg-danger">Admin</span>
                {% elif user.is_staff %}
                  <span class="badge bg-info text-dark">Staff</span>
                {% else %}
                  <span class="badge bg-secondary">User</span>
                {% endif %}
              </td>
              <td>{{ user.date_joined|date:"M d, Y" }}</td>
              <td>
                {% if user.is_active %}
                  <span class="badge bg-success">Active</span>
                {% else %}
                  <span class="badge bg-warning text-dark">Inactive</span>
                {% endif %}
              </td>
              <td>
                {% if user.inviteduser %}
                  {% if user.inviteduser.accepted %}
                    <span class="badge bg-primary">Accepted</span>
                  {% else %}
                    <span class="badge bg-warning text-dark">Pending</span>
                  {% endif %}
                {% else %}
                  <span class="text-muted">—</span>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
          {# Pending Invites Only (no linked User) #}
          {% for invite in pending_invites %}
            <tr class="bg-body">
              <td>
                <em>—</em>
              </td>
              <td class="text-muted">{{ invite.email }}</td>
              <td>
                <span class="badge bg-secondary">Invited</span>
              </td>
              <td>
                <em>—</em>
              </td>
              <td>
                <span class="badge bg-warning text-dark">Pending</span>
              </td>
              <td>
                <span class="badge bg-warning text-dark">Pending</span>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="text-muted">No users found.</p>
  {% endif %}
</div>
