<div class="sidebar d-flex flex-column py-2 rounded-2 shadow-lg"
     id="sidebar">
  <a href="{% url 'home' %}"
     class="d-flex text-decoration-none justify-content-start align-items-center px-3 py-2 border-bottom"
     id="sidebar-brand">
    <div class="d-flex align-items-center" id="sidebar-brand-content">
      <i class="bi bi-box2-fill fs-4" id="sidebar-icon"></i>
      <span class="fs-4 fw-semibold sidebar-label ms-2">Stockflow</span>
    </div>
  </a>
  <div class="sidebar-menu-scrollable flex-grow-1 overflow-auto">
    <ul class="nav nav-pills flex-column mb-auto">
      <li class="nav-item">
        <a href="{% url 'home' %}"
           class="nav-link sidebar-item {% if request.resolver_match.url_name == 'home' %}active{% endif %}">
          <div>
            <i class="bi bi-house fs-5 me-1"></i>
            <span class="sidebar-label">Home</span>
          </div>
        </a>
      </li>
      <li class="nav-item">
        {# Define all URLs that should cause 'Inventory' to expand #}
        {% with inventory_group_urls='items add_item import_items view_item edit_item categories add_category view_category edit_category units add_unit view_unit edit_unit inventory_adjustments add_adjustment view_adjustment edit_adjustment' %}
          <a class="nav-link sidebar-item {% if request.resolver_match.url_name in inventory_group_urls.split %}active{% endif %}"
            data-bs-toggle="collapse"
            href="#inventoryCollapse"
            role="button"
            {# Set aria-expanded based on whether a URL inside this group is active #}
            aria-expanded="{% if request.resolver_match.url_name in inventory_group_urls.split %}true{% else %}false{% endif %}"
            aria-controls="inventoryCollapse">
            <div>
              <i class="bi bi-box-seam fs-5 me-1"></i>
              <span class="sidebar-label">Inventory</span>
            </div>
            <i class="bi bi-chevron-down sidebar-chevron"></i>
          </a>
        {% endwith %}
        {# Add 'show' class to the collapse div if any of its child URLs are active #}
        <div class="collapse {% if request.resolver_match.url_name in inventory_group_urls.split %}show{% endif %}"
             id="inventoryCollapse">
          <ul class="btn-toggle-nav fw-normal pb-1 ps-4 mt-1">
            <li>
              {% with item_urls='items add_item import_items view_item edit_item' %}
                <a href="{% url 'items' %}"
                   class="nav-link link-body-emphasis sidebar-sub-item {% if request.resolver_match.url_name in item_urls.split %}active{% endif %}">Items</a>
              {% endwith %}
            </li>
            <li>
              {% with category_urls='categories add_category edit_category view_category' %}
                <a href="{% url 'categories' %}"
                   class="nav-link link-body-emphasis sidebar-sub-item {% if request.resolver_match.url_name in category_urls.split %}active{% endif %}">Categories</a>
              {% endwith %}
            </li>
            <li>
              {% with unit_urls='units add_unit edit_unit view_unit' %}
                <a href="{% url 'units' %}"
                   class="nav-link link-body-emphasis sidebar-sub-item {% if request.resolver_match.url_name in unit_urls.split %}active{% endif %}">Units of Measure</a>
              {% endwith %}
            </li>
            <li>
              {% with adjustment_urls='inventory_adjustments add_adjustment view_adjustment edit_adjustment' %}
                <a href="{% url 'inventory_adjustments' %}"
                   class="nav-link link-body-emphasis sidebar-sub-item {% if request.resolver_match.url_name in adjustment_urls %}active{% endif %}">Adjustments</a>
              {% endwith %}
            </li>
          </ul>
        </div>
      </li>
      <li class="nav-item">
        {# Example for Sales - adjust sales_group_urls with your actual sales URLs #}
        {% with sales_group_urls='new_sale_url sales_history_url customers_url' %}
          {# Replace with actual URL names #}
          <a class="nav-link sidebar-item {% if request.resolver_match.url_name in sales_group_urls.split %}active{% endif %}"
             data-bs-toggle="collapse"
             href="#salesCollapse"
             role="button"
             aria-expanded="{% if request.resolver_match.url_name in sales_group_urls.split %}true{% else %}false{% endif %}"
             aria-controls="salesCollapse">
            <div>
              <i class="bi bi-cart2 fs-5 me-1"></i>
              <span class="sidebar-label">Sales</span>
            </div>
            <i class="bi bi-chevron-down sidebar-chevron"></i>
          </a>
        {% endwith %}
        <div class="collapse {% if request.resolver_match.url_name in sales_group_urls.split %}show{% endif %}"
             id="salesCollapse">
          <ul class="btn-toggle-nav fw-normal pb-1 ps-4 mt-1">
            <li>
              <a href="#" class="nav-link link-body-emphasis sidebar-sub-item rounded">New Sale</a>
            </li>
            <li>
              <a href="#" class="nav-link link-body-emphasis sidebar-sub-item rounded">Sales History</a>
            </li>
            <li>
              <a href="#" class="nav-link link-body-emphasis sidebar-sub-item rounded">Customers</a>
            </li>
          </ul>
        </div>
      </li>
      <li class="nav-item">
        {# Example for Purchases - adjust purchase_group_urls with your actual purchase URLs #}
        {% with purchase_group_urls='new_purchase_url purchase_orders_url suppliers_url' %}
          {# Replace with actual URL names #}
          <a class="nav-link sidebar-item {% if request.resolver_match.url_name in purchase_group_urls.split %}active{% endif %}"
             data-bs-toggle="collapse"
             href="#purchasesCollapse"
             role="button"
             aria-expanded="{% if request.resolver_match.url_name in purchase_group_urls.split %}true{% else %}false{% endif %}"
             aria-controls="purchasesCollapse">
            <div>
              <i class="bi bi-bag fs-5 me-1"></i>
              <span class="sidebar-label">Purchases</span>
            </div>
            <i class="bi bi-chevron-down sidebar-chevron"></i>
          </a>
        {% endwith %}
        <div class="collapse {% if request.resolver_match.url_name in purchase_group_urls.split %}show{% endif %}"
             id="purchasesCollapse">
          <ul class="btn-toggle-nav fw-normal pb-1 ps-4 mt-1">
            <li>
              <a href="#" class="nav-link link-body-emphasis sidebar-sub-item rounded">New Purchase</a>
            </li>
            <li>
              <a href="#" class="nav-link link-body-emphasis sidebar-sub-item rounded">Purchase Orders</a>
            </li>
            <li>
              <a href="#" class="nav-link link-body-emphasis sidebar-sub-item rounded">Suppliers</a>
            </li>
          </ul>
        </div>
      </li>
      <li class="nav-item">
        {# Example for Reports - adjust report_group_urls with your actual report URLs #}
        {% with report_group_urls='sales_report_url inventory_report_url profit_loss_url' %}
          {# Replace with actual URL names #}
          <a class="nav-link sidebar-item {% if request.resolver_match.url_name in report_group_urls.split %}active{% endif %}"
             data-bs-toggle="collapse"
             href="#reportsCollapse"
             role="button"
             aria-expanded="{% if request.resolver_match.url_name in report_group_urls.split %}true{% else %}false{% endif %}"
             aria-controls="reportsCollapse">
            <div>
              <i class="bi bi-bar-chart fs-5 me-1"></i>
              <span class="sidebar-label">Reports</span>
            </div>
            <i class="bi bi-chevron-down sidebar-chevron"></i>
          </a>
        {% endwith %}
        <div class="collapse {% if request.resolver_match.url_name in report_group_urls.split %}show{% endif %}"
             id="reportsCollapse">
          <ul class="btn-toggle-nav fw-normal pb-1 ps-4 mt-1">
            <li>
              <a href="#" class="nav-link link-body-emphasis sidebar-sub-item rounded">Sales Report</a>
            </li>
            <li>
              <a href="#" class="nav-link link-body-emphasis sidebar-sub-item rounded">Inventory Report</a>
            </li>
            <li>
              <a href="#" class="nav-link link-body-emphasis sidebar-sub-item rounded">Profit &amp; Loss</a>
            </li>
          </ul>
        </div>
      </li>
    </ul>
  </div>
  <hr class="mt-auto">
  <div class="text-center mt-auto px-2">
    <button class="btn btn-outline-secondary btn-sm w-100" id="sidebarToggle">
      <i class="bi bi-chevron-left" id="sidebarToggleIcon"></i>
    </button>
  </div>
</div>
<div id="floatingChevronContainer"></div>
